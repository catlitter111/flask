<!-- pages/feature/detail/detail.wxml - ç‰¹å¾è¯†åˆ«è¯¦æƒ…é¡µé¢ -->
<view class="container" wx:if="{{target}}">
  <!-- å¤´éƒ¨ä¿¡æ¯å¡ç‰‡ -->
  <view class="target-header card">
    <view class="header-info">
      <view class="target-avatar">
        <view class="avatar-colors">
          <view class="color-dot large" style="background-color: {{target.topColor}};"></view>
          <view class="color-dot large" style="background-color: {{target.bottomColor}};"></view>
        </view>
      </view>
      <view class="target-details">
        <text class="target-name">{{target.name || 'æœªå‘½åç›®æ ‡'}}</text>
        <text class="target-desc">{{target.topColorName}}è¡£{{target.bottomColorName}}è£¤</text>
        <text class="target-time">è¯†åˆ«æ—¶é—´ï¼š{{target.timestamp}}</text>
        <view class="target-status">
          <text class="status-badge {{target.isFollowing ? 'following' : 'saved'}}">
            {{target.isFollowing ? 'ğŸ¯ è·Ÿéšä¸­' : 'ğŸ’¾ å·²ä¿å­˜'}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- å›¾ç‰‡æŸ¥çœ‹åŒºåŸŸ -->
  <view class="image-section card">
    <view class="section-header">
      <text class="section-title">ğŸ“· è¯†åˆ«å›¾ç‰‡</text>
      <text class="section-subtitle">æŸ¥çœ‹åŸå›¾å’Œå¤„ç†ç»“æœ</text>
    </view>
    
    <view class="image-actions">
      <button class="image-btn" bindtap="viewOriginalImage" wx:if="{{target.image_data}}">
        <view class="btn-icon">ğŸ–¼ï¸</view>
        <text class="btn-text">æŸ¥çœ‹åŸå›¾</text>
      </button>
      <button class="image-btn" bindtap="viewProcessedImage" wx:if="{{target.processed_image}}">
        <view class="btn-icon">ğŸ”</view>
        <text class="btn-text">å¤„ç†ç»“æœ</text>
      </button>
      <view class="no-image" wx:if="{{!target.image_data && !target.processed_image}}">
        <text class="no-image-text">æš‚æ— å›¾ç‰‡æ•°æ®</text>
      </view>
    </view>
  </view>

  <!-- æœè£…é¢œè‰²è¯¦æƒ… -->
  <view class="color-detail-section card">
    <view class="section-header" bindtap="toggleColorDetails">
      <view class="header-left">
        <text class="section-title">ğŸ¨ æœè£…é¢œè‰²åˆ†æ</text>
        <text class="section-subtitle">è¯¦ç»†çš„é¢œè‰²è¯†åˆ«ç»“æœ</text>
      </view>
      <view class="expand-icon {{showColorDetails ? 'expanded' : ''}}">
        <text>â–¼</text>
      </view>
    </view>
    
    <!-- é¢œè‰²é¢„è§ˆ -->
    <view class="color-preview-section">
      <view class="color-item-large">
        <view class="color-swatch" style="background-color: {{target.topColor}};">
          <text class="color-label">ä¸Šè¡£</text>
        </view>
        <view class="color-info">
          <text class="color-name">{{target.topColorName}}</text>
          <text class="color-hex">{{target.topColor}}</text>
        </view>
      </view>
      
      <view class="color-item-large">
        <view class="color-swatch" style="background-color: {{target.bottomColor}};">
          <text class="color-label">ä¸‹è£…</text>
        </view>
        <view class="color-info">
          <text class="color-name">{{target.bottomColorName}}</text>
          <text class="color-hex">{{target.bottomColor}}</text>
        </view>
      </view>
    </view>
    
    <!-- è¯¦ç»†é¢œè‰²ä¿¡æ¯ -->
    <view class="color-details" wx:if="{{showColorDetails && target.features}}">
      <view class="detail-title">ğŸ”¬ è¯¦ç»†åˆ†æ</view>
      <view class="detail-grid">
        <view class="detail-item">
          <text class="detail-label">ä¸Šè¡£ç½®ä¿¡åº¦</text>
          <text class="detail-value">{{target.features.clothing_colors.top.confidence || 0}}%</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">ä¸‹è£…ç½®ä¿¡åº¦</text>
          <text class="detail-value">{{target.features.clothing_colors.bottom.confidence || 0}}%</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">é¢œè‰²ç©ºé—´</text>
          <text class="detail-value">RGB</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ£€æµ‹ç²¾åº¦</text>
          <text class="detail-value">é«˜</text>
        </view>
      </view>
    </view>
  </view>

  <!-- èº«ä½“æ¯”ä¾‹è¯¦æƒ… -->
  <view class="proportion-detail-section card">
    <view class="section-header" bindtap="toggleProportionDetails">
      <view class="header-left">
        <text class="section-title">ğŸ“ èº«ä½“æ¯”ä¾‹åˆ†æ</text>
        <text class="section-subtitle">16é¡¹è¯¦ç»†çš„èº«ä½“æ¯”ä¾‹æ•°æ®</text>
      </view>
      <view class="expand-icon {{showProportionDetails ? 'expanded' : ''}}">
        <text>â–¼</text>
      </view>
    </view>
    
    <!-- ä¸»è¦æ¯”ä¾‹ -->
    <view class="main-proportions" wx:if="{{target.body_proportions}}">
      <view class="proportion-item">
        <text class="proportion-label">èº«é«˜æ¯”ä¾‹</text>
        <text class="proportion-value">{{target.body_proportions.height || '0.0'}}</text>
      </view>
      <view class="proportion-item">
        <text class="proportion-label">è‚©å®½æ¯”ä¾‹</text>
        <text class="proportion-value">{{target.body_proportions.shoulderWidth || '0.0'}}</text>
      </view>
      <view class="proportion-item">
        <text class="proportion-label">è…°å›´æ¯”ä¾‹</text>
        <text class="proportion-value">{{target.body_proportions.waist || '0.0'}}</text>
      </view>
    </view>
    
    <!-- è¯¦ç»†æ¯”ä¾‹æ•°æ® -->
    <view class="detailed-proportions" wx:if="{{showProportionDetails}}">
      <view class="detail-title">ğŸ“Š å®Œæ•´æ¯”ä¾‹æ•°æ®</view>
      <scroll-view class="proportion-scroll" scroll-y="true">
        <view class="proportion-grid">
          <view class="proportion-detail-item" 
                wx:for="{{target.detailed_proportions}}" 
                wx:key="index"
                wx:if="{{target.detailed_proportions && target.detailed_proportions.length > 0}}">
            <view class="detail-index">{{index + 1}}</view>
            <view class="detail-content">
              <text class="detail-label">{{item.label || proportionLabels[index].label}}</text>
              <text class="detail-value">{{item.value || '0.000'}}</text>
            </view>
          </view>
          <!-- å¦‚æœæ²¡æœ‰è¯¦ç»†æ¯”ä¾‹æ•°æ®ï¼Œæ˜¾ç¤ºæç¤º -->
          <view class="no-data-tip" wx:if="{{!target.detailed_proportions || target.detailed_proportions.length === 0}}">
            <text class="tip-text">æš‚æ— è¯¦ç»†æ¯”ä¾‹æ•°æ®</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
  <view class="action-section">
    <view class="action-row">
      <button class="action-btn secondary" bindtap="setAsCurrentTarget">
        <view class="btn-icon">ğŸ¯</view>
        <text>è®¾ä¸ºç›®æ ‡</text>
      </button>
      <button class="action-btn primary" bindtap="startFollowing">
        <view class="btn-icon">ğŸš€</view>
        <text>å¼€å§‹è·Ÿéš</text>
      </button>
    </view>
    
    <view class="action-row">
      <button class="action-btn outline" bindtap="shareTarget">
        <view class="btn-icon">ğŸ“¤</view>
        <text>åˆ†äº«</text>
      </button>
      <button class="action-btn danger" bindtap="deleteHistory">
        <view class="btn-icon">ğŸ—‘ï¸</view>
        <text>åˆ é™¤</text>
      </button>
    </view>
  </view>
</view>

<!-- æ— æ•°æ®çŠ¶æ€ -->
<view class="empty-state" wx:else>
  <view class="empty-icon">âŒ</view>
  <text class="empty-text">ç›®æ ‡æ•°æ®ä¸å­˜åœ¨</text>
  <button class="back-btn" bindtap="navigateBack">è¿”å›</button>
</view>

<!-- å›¾ç‰‡æŸ¥çœ‹æ¨¡æ€æ¡† -->
<view class="image-modal {{showImageModal ? 'show' : ''}}" bindtap="closeImageModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">å›¾ç‰‡é¢„è§ˆ</text>
      <button class="modal-close" bindtap="closeImageModal">Ã—</button>
    </view>
    
    <view class="modal-body">
      <image 
        src="{{currentImage}}" 
        mode="aspectFit" 
        class="modal-image"
        bindtap="previewImage" />
    </view>
    
    <view class="modal-footer">
      <button class="preview-btn" bindtap="previewImage">
        <view class="btn-icon">ğŸ”</view>
        <text>å…¨å±æŸ¥çœ‹</text>
      </button>
    </view>
  </view>
</view> 