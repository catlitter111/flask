<!-- pages/feature/feature.wxml - ç‰¹å¾è¯†åˆ«é¡µé¢ -->
<view class="container">
  <!-- ä¸Šä¼ é¢„è§ˆåŒºåŸŸ -->
  <view class="upload-section card">
    <!-- å·¦ä¾§ï¼šä¸Šä¼ åŒºåŸŸ -->
    <view class="upload-area">
      <view class="upload-zone {{uploading ? 'uploading' : ''}}" bindtap="selectFile">
        <view class="upload-content">
          <view class="upload-icon robot-icon">
            <text class="icon">ğŸ“·</text>
          </view>
          <text class="upload-title">ç‚¹å‡»ä¸Šä¼ </text>
          <text class="upload-subtitle">ç…§ç‰‡/è§†é¢‘</text>
        </view>
        
        <!-- ä¸Šä¼ è¿›åº¦ -->
        <view class="upload-progress" wx:if="{{uploading}}">
          <progress percent="{{uploadProgress}}" stroke-width="4" activeColor="#2196F3" />
          <text class="progress-text">ä¸Šä¼ ä¸­ {{uploadProgress}}%</text>
        </view>
      </view>
      
      <!-- é¢„è§ˆå›¾ç‰‡ -->
      <view class="preview-image" wx:if="{{previewImage}}">
        <image src="{{previewImage}}" mode="aspectFit" />
        <view class="preview-overlay">
          <button class="btn-remove" bindtap="removeImage">Ã—</button>
        </view>
      </view>
    </view>
    
    <!-- å³ä¾§ï¼šçŠ¶æ€ä¿¡æ¯ -->
    <view class="status-area">
      <view class="status-header">
        <text class="section-title">è¯†åˆ«çŠ¶æ€</text>
        <view class="status-indicator {{extracting ? 'processing' : (extracted ? 'completed' : 'ready')}}">
          <view class="status-dot"></view>
          <text class="status-text">{{extracting ? 'åˆ†æä¸­' : (extracted ? 'å·²å®Œæˆ' : 'å°±ç»ª')}}</text>
        </view>
      </view>
      
      <view class="file-info">
        <view class="info-item">
          <text class="info-label">æ”¯æŒæ ¼å¼:</text>
          <text class="info-value">JPG, PNG, MP4</text>
        </view>
        <view class="info-item">
          <text class="info-label">æ–‡ä»¶å¤§å°:</text>
          <text class="info-value">â‰¤ 10MB</text>
        </view>
        <view class="info-item" wx:if="{{currentFile}}">
          <text class="info-label">å½“å‰æ–‡ä»¶:</text>
          <text class="info-value">{{currentFile.name}}</text>
        </view>
      </view>
      
    </view>
  </view>

  <!-- åˆ†æç»“æœåŒºåŸŸ -->
  <view class="results-section">
    <view class="section-header">
      <text class="title">è¯†åˆ«ç»“æœ</text>
      <view class="result-stats" wx:if="{{extracted}}">
        <text class="stats-text">ç½®ä¿¡åº¦: {{overallConfidence}}%</text>
      </view>
    </view>

    <!-- å¿«é€Ÿæ“ä½œæŒ‰é’® -->
    <view class="quick-actions">
      <button class="robot-btn" bindtap="selectFile" disabled="{{uploading || extracting}}">
        é€‰æ‹©æ–‡ä»¶
      </button>
      <button class="robot-btn secondary" bindtap="takePhoto" disabled="{{uploading || extracting}}">
        æ‹ç…§
      </button>
      <button class="robot-btn accent" bindtap="recordVideo" disabled="{{uploading || extracting}}">
        å½•åˆ¶
      </button>
    </view>

    <!-- æœè£…é¢œè‰²è¯†åˆ« -->
    <view class="color-analysis card">
      <view class="card-header">
        <text class="section-title">æœè£…é¢œè‰²</text>
        <view class="analysis-badge {{extracted ? 'completed' : 'waiting'}}">
          {{extracted ? 'å·²è¯†åˆ«' : 'å¾…åˆ†æ'}}
        </view>
      </view>
      
      <view class="color-results" wx:if="{{extracted}}">
        <!-- ä¸Šè¡£é¢œè‰² -->
        <view class="color-item">
          <view class="color-preview" style="background-color: {{clothingColors.top.color}};">
            <text class="color-label">ä¸Šè¡£</text>
          </view>
          <view class="color-info">
            <text class="color-name">{{clothingColors.top.name}}</text>
            <text class="color-confidence">{{clothingColors.top.confidence}}%</text>
            <view class="confidence-bar">
              <view class="confidence-fill" style="width: {{clothingColors.top.confidence}}; background-color: {{clothingColors.top.color}};"></view>
            </view>
          </view>
        </view>
        
        <!-- è£¤å­é¢œè‰² -->
        <view class="color-item">
          <view class="color-preview" style="background-color: {{clothingColors.bottom.color}};">
            <text class="color-label">è£¤å­</text>
          </view>
          <view class="color-info">
            <text class="color-name">{{clothingColors.bottom.name}}</text>
            <text class="color-confidence">{{clothingColors.bottom.confidence}}%</text>
            <view class="confidence-bar">
              <view class="confidence-fill" style="width: {{clothingColors.bottom.confidence}}; background-color: {{clothingColors.bottom.color}};"></view>
            </view>
          </view>
        </view>
        
        <!-- é‹å­é¢œè‰² -->
        <view class="color-item" wx:if="{{clothingColors.shoes}}">
          <view class="color-preview" style="background-color: {{clothingColors.shoes.color}};">
            <text class="color-label">é‹å­</text>
          </view>
          <view class="color-info">
            <text class="color-name">{{clothingColors.shoes.name}}</text>
            <text class="color-confidence">{{clothingColors.shoes.confidence}}%</text>
            <view class="confidence-bar">
              <view class="confidence-fill" style="width: {{clothingColors.shoes.confidence}}; background-color: {{clothingColors.shoes.color}};"></view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- ç­‰å¾…åˆ†æçŠ¶æ€ -->
      <view class="waiting-state" wx:else>
        <view class="waiting-icon">ğŸ¨</view>
        <text class="waiting-text">ä¸Šä¼ æ–‡ä»¶åå¼€å§‹é¢œè‰²è¯†åˆ«</text>
      </view>
    </view>

    <!-- èº«ä½“æ¯”ä¾‹åˆ†æ -->
    <view class="proportion-analysis card">
      <view class="card-header">
        <text class="section-title">èº«ä½“æ¯”ä¾‹</text>
        <view class="analysis-badge {{extracted ? 'completed' : 'waiting'}}">
          {{extracted ? '16é¡¹å·²æå–' : 'å¾…åˆ†æ'}}
        </view>
      </view>
      
      <view class="proportion-content">
        <!-- å·¦ä¾§ï¼šå…³é”®æ•°æ® -->
        <view class="proportion-data">
          <view class="data-item" wx:if="{{extracted}}">
            <text class="data-label">èº«é«˜</text>
            <text class="data-value">{{bodyProportions.height}}cm</text>
          </view>
          <view class="data-item" wx:if="{{extracted}}">
            <text class="data-label">è‚©å®½</text>
            <text class="data-value">{{bodyProportions.shoulderWidth}}cm</text>
          </view>
          <view class="data-item" wx:if="{{extracted}}">
            <text class="data-label">èƒ¸å›´</text>
            <text class="data-value">{{bodyProportions.chest}}cm</text>
          </view>
          <view class="data-item" wx:if="{{extracted}}">
            <text class="data-label">è…°å›´</text>
            <text class="data-value">{{bodyProportions.waist}}cm</text>
          </view>
          <view class="data-item" wx:if="{{extracted}}">
            <text class="data-label">è‡€å›´</text>
            <text class="data-value">{{bodyProportions.hip}}cm</text>
          </view>
          
          <!-- ç­‰å¾…çŠ¶æ€ -->
          <view class="waiting-state" wx:if="{{!extracted}}">
            <view class="waiting-icon">ğŸ“</view>
            <text class="waiting-text">ä¸Šä¼ æ–‡ä»¶åå¼€å§‹æ¯”ä¾‹åˆ†æ</text>
          </view>
        </view>
        
        <!-- å³ä¾§ï¼šäººä½“è½®å»“å›¾ -->
        <view class="body-outline">
          <view class="outline-container">
            <!-- äººä½“è½®å»“SVG -->
            <view class="body-svg {{extracted ? 'active' : ''}}">
              <view class="body-part head"></view>
              <view class="body-part torso"></view>
              <view class="body-part left-arm"></view>
              <view class="body-part right-arm"></view>
              <view class="body-part left-leg"></view>
              <view class="body-part right-leg"></view>
              
              <!-- æµ‹é‡ç‚¹ -->
              <view class="measure-point point-shoulder" wx:if="{{extracted}}"></view>
              <view class="measure-point point-chest" wx:if="{{extracted}}"></view>
              <view class="measure-point point-waist" wx:if="{{extracted}}"></view>
              <view class="measure-point point-hip" wx:if="{{extracted}}"></view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- è¯¦ç»†æ•°æ®æŒ‰é’® -->
      <button class="detail-btn" bindtap="showDetailedData" wx:if="{{extracted}}">
        æŸ¥çœ‹16é¡¹è¯¦ç»†æ•°æ®
      </button>
    </view>
  </view>

  <!-- è¯†åˆ«å†å² -->
  <view class="history-section card" wx:if="{{extractedFeatures.length > 0}}">
    <view class="card-header">
      <text class="section-title">è¯†åˆ«å†å²</text>
      <text class="history-count">{{extractedFeatures.length}}æ¡è®°å½•</text>
    </view>
    
    <scroll-view class="history-list" scroll-y="true">
      <view class="history-item {{currentTargetId === item.id ? 'selected' : ''}}" 
            wx:for="{{extractedFeatures}}" wx:key="id" 
            bindtap="selectHistoryTarget" data-target="{{item}}">
        <view class="history-avatar">
          <view class="avatar-colors">
            <view class="color-dot" style="background-color: {{item.topColor}};"></view>
            <view class="color-dot" style="background-color: {{item.bottomColor}};"></view>
          </view>
        </view>
        <view class="history-info">
          <text class="history-title">{{item.name || 'ç›®æ ‡' + (index + 1)}}</text>
          <text class="history-desc">{{item.topColorName}}è¡£{{item.bottomColorName}}è£¤</text>
          <text class="history-time">{{item.timestamp}}</text>
        </view>
        <view class="history-status">
          <text class="status-text {{item.isFollowing ? 'following' : ''}}">
            {{item.isFollowing ? 'è·Ÿéšä¸­' : 'å·²ä¿å­˜'}}
          </text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- åº•éƒ¨æ“ä½œåŒºåŸŸ -->
  <view class="action-section">
    <button class="robot-btn secondary" bindtap="saveFeatures" disabled="{{!extracted}}">
      ä¿å­˜ç‰¹å¾
    </button>
    <button class="robot-btn accent" bindtap="setAsTarget" disabled="{{!extracted}}">
      è®¾ä¸ºç›®æ ‡
    </button>
    <button class="robot-btn" bindtap="startFollowing" disabled="{{!extracted}}">
      å¼€å§‹è·Ÿéš
    </button>
  </view>
</view>

<!-- è¯¦ç»†æ•°æ®å¼¹çª— -->
<view class="modal-overlay {{showDetailModal ? 'show' : ''}}" bindtap="hideDetailModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">16é¡¹èº«ä½“æ¯”ä¾‹è¯¦ç»†æ•°æ®</text>
      <button class="modal-close" bindtap="hideDetailModal">Ã—</button>
    </view>
    
    <scroll-view class="modal-body" scroll-y="true">
      <view class="detail-grid">
        <view class="detail-item" wx:for="{{detailedProportions}}" wx:key="key">
          <text class="detail-label">{{item.label}}</text>
          <text class="detail-value">{{item.value}}</text>
          <text class="detail-unit">{{item.unit}}</text>
        </view>
      </view>
    </scroll-view>
    
    <view class="modal-footer">
      <button class="robot-btn" bindtap="hideDetailModal">ç¡®å®š</button>
    </view>
  </view>
</view>